<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Rubik Smooth Loop</title>

<style>
body {
  margin: 0;
  display: grid;
  place-items: center;
  height: 100vh;
  background: #0b0b14;
}
.wrap { width: min(92vw, 520px); }
h1 {
  color: #fff;
  font-family: system-ui;
  font-size: 18px;
  text-align:center;
  opacity:.85;
  margin: 0 0 14px;
}
</style>
</head>

<body>
<div class="wrap">
  <h1>Perbaiki â†” Rusak (Smooth Loop)</h1>

  <twisty-player
    id="cube"
    style="width:100%; aspect-ratio:1/1;"
    puzzle="3x3x3"
    background="none"
    control-panel="none"
    hint-facelets="none"
    tempo-scale="0.8"
  ></twisty-player>
</div>

<script type="module">
import "https://cdn.cubing.net/js/cubing/twisty";
import { Alg } from "https://cdn.cubing.net/js/cubing/alg";

const player = document.getElementById("cube");

const PAUSE = 600;
const MOVE_COUNT = 22; // seberapa rusak

const sleep = (ms) => new Promise(r => setTimeout(r, ms));

function randomMoves(n) {
  const faces = ["R","L","U","D","F","B"];
  const suf = ["", "'", "2"];
  let out = [];
  let prev = "";

  for (let i = 0; i < n; i++) {
    let f = faces[(Math.random()*faces.length)|0];
    if (f === prev) { i--; continue; }
    prev = f;
    out.push(f + suf[(Math.random()*suf.length)|0]);
  }
  return out.join(" ");
}

function waitFinish() {
  return new Promise(resolve => {
    const check = setInterval(() => {
      if (!player.playing) {
        clearInterval(check);
        resolve();
      }
    }, 50);
  });
}

async function playAlg(alg) {
  player.alg = alg;
  player.play();
  await waitFinish();
}

async function loop() {
  let lastRusak = null;

  while (true) {

    // ===== PERBAIKI =====
    if (lastRusak) {
      const perbaiki = new Alg(lastRusak).invert().toString();
      await playAlg(perbaiki);
      await sleep(PAUSE);
    }

    // ===== RUSAK =====
    const rusak = randomMoves(MOVE_COUNT);
    lastRusak = rusak;
    await playAlg(rusak);
    await sleep(PAUSE);
  }
}

loop();
</script>
</body>
</html>
